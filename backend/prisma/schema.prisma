generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum OtpPurpose {
  VERIFY_EMAIL
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum AccountType {
  ADMINISTRATOR
  EMPLOYEE
}

enum ProjectStatus {
  ACTIVE
  LOCKED
  EXPIRED
}

model User {
  id                String              @id @default(cuid())
  email             String              @unique
  passwordHash      String
  name              String
  firstName         String?
  lastName          String?
  phoneNumber       String?
  address           String?
  gender            Gender?
  level             String?
  dailyRate         Float?
  accountType       AccountType         @default(EMPLOYEE)
  verified          Boolean             @default(false)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  otps              EmailOtp[]
  refreshTokens     RefreshToken[]
  passwordResets    PasswordReset[]
  createdProjects   Project[]           @relation("ProjectCreator")
  projectAssignments ProjectAssignment[]
}

model Project {
  id           String              @id @default(cuid())
  name         String
  description  String?
  startDate    DateTime?
  endDate      DateTime?
  internalCost Float?
  status       ProjectStatus       @default(ACTIVE)
  creatorId    String
  creator      User                @relation("ProjectCreator", fields: [creatorId], references: [id], onDelete: Cascade)
  assignments  ProjectAssignment[]
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
}

model ProjectAssignment {
  id         String   @id @default(cuid())
  projectId  String
  userId     String
  workDays   Int      @default(1)
  dailyRate  Float    @default(0)
  totalCost  Float    @default(0)
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  assignedAt DateTime @default(now())

  @@unique([projectId, userId])
}

model EmailOtp {
  id        String     @id @default(cuid())
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  codeHash  String
  expiresAt DateTime
  purpose   OtpPurpose
  consumed  Boolean    @default(false)
  createdAt DateTime   @default(now())
}

model RefreshToken {
  id        String   @id @default(cuid())
  tokenHash String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  revoked   Boolean  @default(false)
  createdAt DateTime @default(now())
  expiresAt DateTime
}

model PasswordReset {
  id        String   @id @default(cuid())
  tokenHash String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  expiresAt DateTime
}
